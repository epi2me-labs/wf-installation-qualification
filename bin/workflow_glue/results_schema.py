# generated by datamodel-codegen:
#   filename:  results_schema.yml

from __future__ import annotations

from enum import Enum
from typing import Any, List, Optional

from pydantic import Field

from workflow_glue.results_schema_helpers import BaseModel


class CheckResult(BaseModel):
    """
    A result of some check the workflow has performed on a sample, or itself
    """

    check_name: str = Field(..., description='The name of the check')
    check_pass: bool = Field(..., description='If true the check has passed')


class SampleType(Enum):
    """
    The type of the sample
    """

    no_template_control = 'no_template_control'
    positive_control = 'positive_control'
    negative_control = 'negative_control'
    test_sample = 'test_sample'


class QualificationTests(BaseModel):
    """
    Installation quallification tests results
    """

    found_fastq: Optional[bool] = Field(None, description='A FASTQ file for the sample has been found')
    n_reads: Optional[int] = Field(None, description='Number of reads')
    perc_alignments: Optional[int] = Field(None, description='Mapped reads percentage')
    coverage: Optional[int] = Field(None, description='Reference coverage')
    read_count_threshold: Optional[str] = Field(None, description='Number of reads is above threshold')
    positive_correctly_mapped_threshold: Optional[str] = Field(None, description='Mapped reads percentage is above threshold')
    control_mapped_limit: Optional[str] = Field(None, description='Mapped reads percentage is below limit for control samples')
    positive_coverage_threshold: Optional[str] = Field(None, description='Reference coverage is above threshold for positive samples')
    control_coverage_limit: Optional[str] = Field(None, description='Reference coverage is below limit for control samples')
    sample_pass: str = Field(None, description='Sample has passed all quallification tests')

class FastqStats(BaseModel):
    """
    A place to store read statistics
    """

    n_seqs: Optional[int] = Field(None, description='The number of sequencing reads')
    n_bases: Optional[int] = Field(None, description='The number of bases')
    min_length: Optional[int] = Field(None, description='The minimum read length')
    max_length: Optional[int] = Field(None, description='The maximum read length')
    mean_quality: Optional[float] = Field(None, description='The mean read quality')


class ResultsContents(BaseModel):
    tests: QualificationTests = None
    fastq: FastqStats = None


class Sample(BaseModel):
    """
    A sample sheet entry and its corresponding checks and related results
    """

    alias: str = Field(..., description='The alias for the sample given by the user')
    barcode: Optional[str] = Field(..., description='The physical barcode assigned to the sample')
    sample_type: SampleType = Field(..., description='The type of the sample')
    sample_pass: Optional[bool] = Field(
        ..., description='If true the sample has passed workflow checks'
    )
    sample_checks: Optional[List[CheckResult]] = Field(
        ..., description='An array of checks performed on the sample'
    )
    results: ResultsContents = Field(
        ..., description='Further specific workflow results for this sample'
    )


class WorkflowResult(BaseModel):
    """
    Definition for results that will be returned by this workflow. This structure will be passed through by Gizmo speaking clients as WorkflowInstance.results.
    """

    workflow_pass: Optional[bool] = Field(
        ..., description='True if this workflow instance passes all checks'
    )
    workflow_checks: List[CheckResult] = Field(
        ..., description='An array of checks performed on the workflow instance'
    )
    samples: List[Sample] = Field(..., description='Samples in this workflow instance')
